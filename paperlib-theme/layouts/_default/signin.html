{{ define "main" }}

{{ "<!-- Blog Section Start -->" | safeHTML }}

<section class="section">
    <div class="container">
        <div class="row justify-content-md-center mb-3 mt-5">
            <div class="col-md-12" style="text-align: center;">
                <h2>{{ .Title }}</h2>
                <span class="border divider" style="border: none !important;"></span>
            </div>
        </div>
        <form class="row justify-content-center" id="signin-form" method="POST">
            <input type="text" placeholder="Email" name="email" required class="col-3 user-input-box mb-3"
                style="text-align: center; min-width: 250px;">
            <div class="w-100"></div>
            <input type="password" placeholder="Password" name="password" required class="col-3 user-input-box mb-3"
                style="text-align: center; min-width: 250px;">
            <div class="w-100"></div>
            <div class="col-3 mb-3" id="signin-response-info"></div>
            <div class="w-100"></div>
            <a href="/{{ .Lang }}/signup/" class="btn btn-main col-3 mb-1">{{ .Site.Params.signin.registerText }}</a>
            <div class="w-100"></div>
            <button type="submit" class="btn btn-main col-3" id="singin-btn">{{ .Site.Params.signin.signinText }}</button>
        </form>
        <div class="row justify-content-center mt-2" style="font-size: small; text-decoration: underline; cursor: pointer;">
            <a id="password-reset">{{ .Site.Params.signin.resetText }}</a>
        </div>
    </div>
</section>

{{ end }}

{{ define "head" }}

<head>
    <script
        src="https://www.google.com/recaptcha/enterprise.js?render=6Lf3QJweAAAAAGh7PyVgrd105arPlhfE3NvWFUV7"></script>
</head>

{{ end }}

{{ define "script" }}

<script>
    $("#signin-form").submit(function (e) {
        e.preventDefault();
        grecaptcha.enterprise.ready(function () {
            grecaptcha.enterprise.execute('6Lf3QJweAAAAAGh7PyVgrd105arPlhfE3NvWFUV7', { action: 'login' }).then(function (token) {
                $("#signin-response-info").html("");

                $.ajax({
                    url: '/api/auth/signin',
                    type: 'POST',
                    data: {
                        email: $("#signin-form input[name='email']").val(),
                        password: $("#signin-form input[name='password']").val(),
                        recaptchaToken: token
                    },
                    success: function (response) {
                        if (response.code != 200) {
                            $("#signin-response-info").html(response.message);
                        }
                        else {
                            Cookies.set('paperlib', response.token, { expires: 1, path: '/' })
                            window.location.replace("/{{ .Lang }}/dashboard");
                        }
                    }
                });
            });
        });
    });

    $("#password-reset").click(function (e) {
        e.preventDefault();
        grecaptcha.enterprise.ready(function () {
            grecaptcha.enterprise.execute('6Lf3QJweAAAAAGh7PyVgrd105arPlhfE3NvWFUV7', { action: 'reset' }).then(function (token) {
                $("#signup-response-info").html("");

                $.ajax({
                    url: '/api/auth/reset',
                    type: 'POST',
                    data: {
                        email: $("#signup-form input[name='email']").val(),
                        recaptchaToken: token
                    },
                    success: function (response) {
                        $("#signup-response-info").html(response.message);
                    }
                });
            });
        });
    });



</script>

{{ end }}